/*! Slot Car Racer 1.0.0 | (c) 2013 Mandarin */ 
SlotCar={},SlotCar.Boot=function(a){this.game=a},SlotCar.Boot.prototype={preload:function(){},create:function(){var a=this.game,b=a.stage.scale;a.input.maxPointers=1,Phaser.Canvas.setSmoothingEnabled(a.context,!1),a.stage.scaleMode=Phaser.StageScaleMode.NO_SCALE,b.maxWidth=800,b.maxHeight=576,b.forceLandscape=!0,b.pageAlignHorizontally=!0,b.pageAlignVertically=!0,b.setScreenSize(!0),a.state.start("Preloader")}},SlotCar.Game=function(a){this.game=a,this.player=null,this.startData={x:0,y:0,dir:0},this.layer=null},SlotCar.Game.prototype={create:function(){var a=this.game;a.stage.backgroundColor="#000000";var b=a.add.tilemap("test01"),c=a.add.tileset("tiles");this.layer=a.add.tilemapLayer(0,0,800,576,c,b,0),b.forEach(this.lookForStart,this,0,0,800,576),this.player=new SlotCar.Player(a,this.startData)},lookForStart:function(a){if(null!=a.index)switch(a.index){case 2:this.updateStartData(0,a);break;case 13:this.updateStartData(1,a);break;case 5:this.updateStartData(2,a);break;case 9:this.updateStartData(3,a)}},updateStartData:function(a,b){this.startData={dir:a,angle:90*a,x:b.x,y:b.y,layer:this.layer}},update:function(){},render:function(){},loadLevel:function(){}},SlotCar.Player=function(a,b){Phaser.Sprite.call(this,a,0,b.y,"entities","RaceCar.png"),this.layer=b.layer,this.current={index:0,x:b.x,y:b.y,isTurn:!1,isChecked:!1},this.crashAngle=0,this.crash=!1,this.anchor.setTo(.5,.5),this.angle=b.angle;var c=this.layer.tileWidth,d=this.layer.tileHeight;this.x=b.x*c+.5*c,this.y=b.y*d+.5*d,a.add.existing(this),this.throttle=a.input.keyboard.addKey(Phaser.Keyboard.UP),this.friction=2,this.velocity=0,this.maxVelocity=5,this.updateCurrentTile()},SlotCar.Player.prototype=Object.create(Phaser.Sprite.prototype),SlotCar.Player.prototype.constructor=SlotCar.Player,SlotCar.Player.prototype.update=function(){if(this.velocity>0&&(this.updateCurrentTile(),this.current.isTurn&&!this.current.isChecked)){var a=this.layer.tileHeight,b=this.layer.tileWidth,c=this.current.y,d=this.current.x;switch(this.crashAngle=this.angle,this.angle){case 0:this.y<=c*a+a/2&&(this.y=c*a+a/2,this.updateAngle(),this.current.isChecked=!0);break;case-180:this.y>=c*a+a/2&&(this.y=c*a+a/2,this.updateAngle(),this.current.isChecked=!0);break;case 90:this.x>=d*b+b/2&&(this.x=d*b+b/2,this.updateAngle(),this.current.isChecked=!0);break;case-90:this.x<=d*b+b/2&&(this.x=d*b+b/2,this.updateAngle(),this.current.isChecked=!0)}}this.crash||(this.throttle.isDown&&(this.velocity+=.5,this.velocity>this.maxVelocity&&(this.velocity=this.maxVelocity)),0==this.angle&&(this.y-=this.velocity),-180==this.angle&&(this.y+=this.velocity),90==this.angle&&(this.x+=this.velocity),-90==this.angle&&(this.x-=this.velocity),this.throttle.isUp&&(this.velocity-=this.friction,this.velocity<0&&(this.velocity=0)))},SlotCar.Player.prototype.updateCurrentTile=function(){var a={};if(this.layer.getTileXY(this.x,this.y,a),a.x!=this.current.x||a.y!=this.current.y){this.current.x=a.x,this.current.y=a.y,this.current.index=this.layer.tilemap.getTile(this.current.x,this.current.y),this.current.isChecked=!1;var b=this.current.index;this.current.isTurn=14==b||10==b||7==b||6==b?!0:!1}},SlotCar.Player.prototype.updateAngle=function(){switch(this.current.index){case 14:90==this.angle&&(this.angle=-180),0==this.angle&&(this.angle=-90);break;case 10:-90==this.angle&&(this.angle=0),-180==this.angle&&(this.angle=90);break;case 7:0==this.angle&&(this.angle=90),-90==this.angle&&(this.angle=-180);break;case 6:90==this.angle&&(this.angle=0),-180==this.angle&&(this.angle=-90)}},SlotCar.Player.prototype.crash=function(){},SlotCar.Preloader=function(a){this.game=a,this.background=null,this.progressBar=null,this.preloadBg=null},SlotCar.Preloader.prototype={preload:function(){var a=this.game;a.load.atlasJSONHash("entities","assets/atlas/atlas_entities_0.png","assets/atlas/atlas_entities_0.json"),a.load.tilemap("test01","assets/maps/test01.json",null,Phaser.Tilemap.TILED_JSON),a.load.tileset("tiles","assets/atlas/atlas_tileset_0.png",32,32)},update:function(){this.game.load.hasLoaded&&this.game.state.start("Game")}};